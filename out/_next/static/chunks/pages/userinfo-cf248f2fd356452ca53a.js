(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[379],{7452:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return g}});var r=n(2809),a=n(7294),s=n(1664),o=n(1163),l=n(4649),c=n(9501),i=n(3890),u=n(1389),d=n(5893);function p(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function f(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?p(Object(n),!0).forEach((function(t){(0,r.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):p(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var m=function(e){var t=e.avatarUrl,n=void 0===t?"":t,r=e.size,s=void 0===r?24:r,o=(0,a.useState)(i.S_),l=o[0],c=o[1],u=(0,a.useState)("6rem"),p=u[0],f=u[1];return(0,a.useEffect)((function(){var e=i.S_;n.length>3&&(e="".concat(n)),console.log("avatarUrl",e),c(e)}),[n]),(0,a.useEffect)((function(){var e=parseInt(s/4);f("".concat(e,"rem"))}),[s]),(0,d.jsx)("div",{className:"avatar",children:(0,d.jsx)("div",{className:"mb-8 rounded-full ring ring-primary ring-offset-base-100 ring-offset-2",style:{width:p,height:p},children:(0,d.jsx)("img",{src:l})})})},h=function(e){var t=e.avatarUrl,n=e.size,r=e.uploadResponseHandle,s=(0,a.useState)(i.S_),o=s[0],l=s[1],c=(0,a.useState)([]),p=c[0],h=c[1],v=(0,a.useState)(""),b=v[0],x=v[1],j=(0,a.useState)("error"),g=j[0],O=j[1],N=(0,a.useState)(0),w=N[0],y=N[1],S=(0,u.uI)({accept:"image/*",onDrop:function(e){h(e.map((function(e){return Object.assign(e,{preview:URL.createObjectURL(e)})})))}}),P=S.getRootProps,_=S.getInputProps,U=function(){console.log("updateAvatarShowUrl...");var e="".concat(i.S_);t.length>3&&(e="".concat(t)),p.length>0&&void 0!==p[0].preview&&(console.log("updateAvatarShowUrl files[0].preview",p[0].preview),e=p[0].preview),l(e)};return(0,a.useEffect)((function(){var e;p.length>0&&void 0!==p[0].preview&&(e=p[0],(0,i.yR)(e,(function(e,t){console.log("uploadAvatar responseData",e,t),1e3===e.code&&(x("\u56fe\u7247\u4e0a\u4f20\u6210\u529f!"),O("success"),y(w+1),r(e))}),(function(e){x("\u56fe\u7247\u4e0a\u4f20\u5931\u8d25..."),O("error"),y(w+1),console.log("uploadAvatar error",e)})),U())}),[p]),(0,a.useEffect)((function(){U()}),[t]),(0,d.jsxs)("div",{className:"flex justify-center items-center bg-base-200 w-full rounded ring-offset-2 ring p-4",children:[(0,d.jsx)(m,{avatarUrl:o,size:n}),(0,d.jsxs)("div",f(f({},P({className:"dropzone"})),{},{children:[(0,d.jsx)("input",f({},_())),(0,d.jsx)("button",{className:"btn btn-link",children:"\u4e0a\u4f20\u5934\u50cf"})]})),(0,d.jsx)(i.F2,{tipsText:b,tipsType:g,openTipsCount:w})]})};function v(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function b(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?v(Object(n),!0).forEach((function(t){(0,r.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):v(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}h.defaultProps={avatarUrl:"",size:24,uploadResponseHandle:function(e){console.log("uploadResponseHandle",e)}};var x=c.Ry().shape({name:c.Z_().required("\u59d3\u540d\u4e0d\u80fd\u4e3a\u7a7a...").max(32,"\u59d3\u540d\u4e0d\u80fd\u8d85\u8fc732\u4e2a\u5b57..."),explains:c.Z_().max(128,"\u63cf\u8ff0\u4e0d\u80fd\u8d85\u8fc7128\u4e2a\u5b57...")}),j=function(){var e,t=(0,o.useRouter)(),n=(0,a.useState)({}),r=n[0],c=n[1],u=(0,a.useState)(0),p=u[0],f=u[1],m=(0,a.useState)(0),v=m[0],j=m[1],g=(0,a.useRef)({}),O=(0,a.useState)(""),N=O[0];O[1];(0,a.useEffect)((function(){f(p+1)}),[]);var w=(0,l.TA)({initialValues:{name:"",explains:""},validationSchema:x,onSubmit:function(e){console.log(e),function(e){console.log("updateCustomerDataHandle",e);var t=i.a5.userInfoUpdate,n={};for(var a in t)n[t[a]]=e[a];g.current=b(b({},r),n),console.log("updateUserInfo.current",g.current),j(v+1)}(e)}});return(0,d.jsxs)("div",{className:"hero",children:[(0,d.jsx)("div",{className:"hero-content",children:(0,d.jsx)("div",{className:"card flex-shrink-0 w-full max-w-sm shadow-2xl bg-base-100",children:(0,d.jsxs)("div",{className:"card-body",children:[(0,d.jsx)(h,{avatarUrl:null!==(e=r.avatar_url)&&void 0!==e?e:"",size:24,uploadResponseHandle:function(e){console.log("responseUpdateAvatar",e),c(b(b({},r),{},{avatar:e.image_cos_name}))}}),(0,d.jsxs)("form",{onSubmit:w.handleSubmit,children:[(0,d.jsx)("div",{className:"form-control",children:(0,d.jsxs)("label",{className:"label",children:[(0,d.jsx)("span",{className:"label-text",children:"\u624b\u673a\u53f7\u7801:"}),(0,d.jsx)("span",{className:"label-text",children:r.mobile})]})}),(0,d.jsxs)("div",{className:"form-control",children:[(0,d.jsx)("label",{className:"label",children:(0,d.jsx)("span",{className:"label-text",children:"\u6635\u79f0"})}),(0,d.jsx)("input",{name:"name",placeholder:"Nickname",className:"input input-bordered",value:w.values.name,onChange:w.handleChange}),w.touched.name&&w.errors.name&&(0,d.jsx)("div",{className:"text-sm text-red-600",children:w.errors.name})]}),(0,d.jsxs)("div",{className:"form-control",children:[(0,d.jsx)("label",{className:"label",children:(0,d.jsx)("span",{className:"label-text",children:"\u81ea\u6211\u4ecb\u7ecd"})}),(0,d.jsx)("textarea",{name:"explains",placeholder:"Description",className:"input input-bordered input-lg",value:w.values.explains,onChange:w.handleChange}),w.touched.explains&&w.errors.explains&&(0,d.jsx)("div",{className:"text-sm text-red-600",children:w.errors.explains})]}),(0,d.jsxs)("div",{className:"form-control mt-6",children:[(0,d.jsx)("button",{type:"submit",className:"btn btn-wide btn-primary",children:"\u4fdd\u5b58\u4fee\u6539"}),N.length>0&&(0,d.jsx)("div",{className:"text-sm text-red-600",children:N})]})]}),(0,d.jsx)(s.default,{href:"/",children:(0,d.jsx)("button",{className:"btn btn-wide btn-link mt-4",children:"\u8fd4\u56de\u9996\u9875"})})]})})}),(0,d.jsx)(i.LO,{api:i.MB.customerInfo,method:"GET",data:{},resolveBk:function(e){console.log("responseUserData:",e),c(b(b({},r),e)),w.setFieldValue("name",e.name),w.setFieldValue("explains",e.explains)},requestCount:p}),(0,d.jsx)(i.LO,{api:i.MB.customerInfo,method:"PUT",data:g.current,resolveBk:function(e){console.log("responseUpdateUserData",e),c(e),t.push("/")},requestCount:v})]})};function g(){return(0,d.jsx)(j,{className:"flex flex-col justify-center items-center",children:"SignIn page"})}},9554:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/userinfo",function(){return n(7452)}])}},function(e){e.O(0,[774,755,893,364,890,888,179],(function(){return t=9554,e(e.s=t);var t}));var t=e.O();_N_E=t}]);